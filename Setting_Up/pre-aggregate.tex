\subsubsection{Description of Process}
Stairwalker makes use of the Pre-Aggregate functions. These functions create a granularity in the dataset and calculate blocks at the lowest granularity for certain dimensions. Then subsequent blocks of higher granularity are built up from lower blocks. This creates a new dataset which as summarized the original dataset in terms of blocks which represent some significant data for every level of granularity and dimension.

%Is dit duidelijk? Klopt dit eigenlijk??
%Nog iets met index of zo...
Concretely take the dataset of tweets sent within the netherlands. A pre-aggregation of this data could be in the following form. As significant data we consider the number of tweets in the x- and y-coordinate dimensions. We then set a highest granularity (zoom). The pre-aggregate algorithm then creates blocks bounded by the x- and y-coordinates at the highest granularity and for all those blocks calculates the number of tweets within those coordinates. Then each subsequent layer is built up from the previous layer. The final result is a new dataset which contains all blocks with the number of tweets in a coordinate block at each level of granularity.

\subsubsection{PreAggregate Tool}
\label{sec:preaggtool}
To do the Pre-Aggregation step a tool has been developed which is explained here. The tool can be found in the directory \lstinline|neogeo/pre-aggregate-tools/|. To generate the binary tools from source the Appassembler plugin of Maven is used. Run the following command to generate the tool.
\begin{lstlisting}
mvn package appassembler:assemble
\end{lstlisting}
After successful completion of this command a new directory \lstinline|appassembler| will have been created in the \lstinline|target| directory containing a \lstinline|repo| and a \lstinline|bin| directory. The \lstinline|bin| directory contains the actual binaries of the tool (in both Linux/Unix and Windows version) and the \lstinline|repo| directory contains the tool dependencies. The tool should now be ready for use. An example of how to compile and use the tool to create a pre-aggregation index is given in \Fref{sec:examplePreAggIndex}.

The tool is used to create a PreAggregate index for a table with $\textit{n}$ dimensions and a measure/aggregate column. It uses with the following commands:
\begin{lstlisting}[basicstyle=\small]
usage: create-pa-index
 -axistosplit <axis index>    index of axis to split
 -chunksize <size>            maximum chunk size after split
 -config <file>               PreAggregate XML config file
 -d,--database <dbname>       name of database
 -dbtype <postgresql|monetdb> type of database
 -h,--host <host>             database host name or ip address
 -help                        prints this help message
 -p,--port <port>             port number of the database
 -password <password>         database password
 -s,--schema <schema>         schema name in the database
 -u,--user <user>             database username
 -v,--verbose                 Enable verbose output logging
\end{lstlisting}
The tool is dependent on the \lstinline|PreAggregate.XML| config file which is used to define the PreAggregate index by specifying the column to aggregate, the type of aggregate that should done and the dimensions to include. In the \lstinline|neogeo/pre-aggregate-tools/| directory a sample configuration file is included.

\todo[inline, size=\small]{How does this tool work nominal axis? More preprocessing may be required when first parsing words? Example london\_words or gender\_words}

See~\Fref{sec:PreAggregateDev} for more detail about creating a pre-aggregate index not using the special help tool.

Apart from creating a new pre-aggregate index table \lstinline|<original-table-name>_pa| pre-aggregation also creates/updates two other tables, these are \lstinline|pre_aggregate| and \lstinline|pre_aggregate_axis|. These two tables are support tables for the aggregation. They contain information about which tables have been aggregated and which axis have been used in pre-aggregation.
\subsubsection{Current Status Support of Datatypes}
\begin{enumerate}
	\item Aggregate Axis
	\item Metric Axis
	\item Nominal Axis
\end{enumerate}

\subsubsection{Current Status Support of Aggregation Types}
Currently there are 4 different aggregation types which can be used. These are discussed below. Note that there is an \lstinline|ALL| option which returns all aggregate types in the pre-aggregate index. Furthermore these types can be used to create other types such as average.

The current options are as follows:
\begin{enumerate}
\item \lstinline|ALL|: 	Returns all the aggregation types mentioned below.
\item \lstinline|COUNT|: Returns the total amount of data in an aggregate box.
\item \lstinline|SUM|: returns the total value of all data added up to each other. For instance a sum on the tweet length will result in the total amount of characters tweeted in a tile.
\item \lstinline|MIN|: Returns the lowest value of all data that is aggregated. With the example of tweet length, it will returns the value of the lowest length tweet in that tile.
\item \lstinline|MAX|: Returns the highest value of all data that is aggregated. With the example of tweet length, it will returns the value of the highest length tweet in that tile.
\end{enumerate}

\todo[inline, size=\small]{Small note, when using the pre-aggregate tool (created by Dennis) for the example \lstinline|ALL| was used as it crashed when using \lstinline|COUNT|, this should be looked into.}
It is important to chose the right type in order to get a good representation of the data. To show the total amount in a tile, one should chose \lstinline|COUNT| as this will returns the total number of data points in a tile. Whereas if one wants only the highest value in the data (for example the highest building in an area) then \lstinline|MAX| should be used.
